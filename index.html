<!DOCTYPE html>
<html>
<body>
  <h1>Reddit</h1>
</body>
<script>
const LOGGER=!0;var map=new Map();loadURL("https://cors-hackity.herokuapp.com/https://reddit.com/r/all/.json?sort=hot&limit=15",onDataLoaded);function loadURL(url,callBack){if(document.getElementById("loadMore")){document.getElementById("loadMore").remove()}
var xhr=new XMLHttpRequest();xhr.open("GET",url,!0);xhr.setRequestHeader("Accept","application/json");xhr.onloadend=onLoadEnd(xhr,callBack);xhr.send()}
function onLoadEnd(request,callBack){return function(){var status=request.status;var result=String(request.response);if(status>=200&&status<300)callBack(result)}}
function onDataLoaded(object){object=JSON.parse(object);logger(object);for(article in object.data.children){var infos=object.data.children[article];map.set(infos.data.name,JSON.stringify(infos));addArticle(infos)}
var url="https://cors-hackity.herokuapp.com/https://reddit.com/r/all/.json?sort=hot&limit=15&after="+object.data.after;addButton('loadMore','Load more','height:5vh;width:100vw;font-size:3em;',url,function(){loadURL(url,onDataLoaded)})}
function addButton(id,textContent,cssText,url,callback){var loadMore=document.createElement('button');loadMore.id=id;loadMore.textContent=textContent;loadMore.style.cssText=cssText;loadMore.onclick=callback;document.body.appendChild(loadMore)}
function addArticle(infos){var subreddit=infos.data.subreddit_name_prefixed;var domain=infos.data.domain;var titleBar=document.createElement('div');titleBar.id=infos.data.name+'title';titleBar.style.cssText='display:flex;';var titleLink=document.createElement('a');titleLink.href='https://reddit.com/'+subreddit;titleLink.textContent=subreddit;titleLink.style.cssText='font-size:2em;overflow:hidden;';var websiteLink=document.createElement('a');websiteLink.href=infos.data.url;websiteLink.textContent=domain;websiteLink.style.cssText='font-size:2em;';var commentsLink=document.createElement('a');commentsLink.href='https://reddit.com/'+infos.data.permalink;commentsLink.textContent='com: '+infos.data.num_comments;commentsLink.style.cssText='font-size:2em;';var bullet=document.createElement('span');bullet.textContent='â€¢';bullet.style.cssText='font-size:2em;margin:1vw;';titleBar.appendChild(titleLink);titleBar.appendChild(bullet);titleBar.appendChild(websiteLink);titleBar.appendChild(bullet.cloneNode(!0));titleBar.appendChild(commentsLink);document.body.appendChild(titleBar);var node=document.createElement('div');node.id=infos.data.name;node.style.cssText='display:flex;border-bottom: 1px solid black;width:100vw;';var thumbnail=document.createElement('img');thumbnail.style.cssText='width:25vw;height:10vh;';thumbnail.src=infos.data.thumbnail;var title=document.createElement('h2');title.style.cssText='width:75vw;';title.textContent=infos.data.title;node.appendChild(thumbnail);node.appendChild(title);document.body.appendChild(node);document.getElementById(node.id).onclick=function(){addElement(this)}}
function addElement(parentNode){var bigId=parentNode.id+'big';if(document.body.contains(document.getElementById(bigId))){document.getElementById(bigId).remove()}else{var value=map.get(parentNode.id);var infos=JSON.parse(value);if(infos.data.is_video){addVideo("100%","auto",infos.data.secure_media.reddit_video.fallback_url,parentNode)}else if(infos.data.url.includes(".gifv")){var videoUrl=infos.data.url.replace(".gifv",".mp4");addVideo("100%","auto",videoUrl,parentNode)}else if(infos.data.url.includes(".jpg")||infos.data.url.includes(".png")){addImage(infos.data.url,parentNode)}else if(!(Object.entries(infos.data.secure_media_embed).length===0&&infos.data.secure_media_embed.constructor===Object)){addEmbedElement(infos.data.secure_media_embed.content,parentNode)}else if(infos.data.url.includes("https://imgur.com/")){var img=infos.data.url.substring(0,8)+'i.'+infos.data.url.substring(8)+'.jpg';addImage(img,parentNode)}else{logger('not yet implemented: '+infos.data.url);logger(infos)}}}
function addEmbedElement(content,parentNode){var embed=document.createElement('div');embed.style.cssText='width:100vw;';embed.id=parentNode.id+'big';embed.appendChild(document.createRange().createContextualFragment(unescapeHtml(content)));embed.firstChild.style.cssText='width:100vw;';parentNode.parentNode.insertBefore(embed,parentNode.nextSibling)}
function addImage(url,parentNode){var image=document.createElement('img');image.style.cssText='width:100vw;';image.src=url;image.id=parentNode.id+'big';parentNode.parentNode.insertBefore(image,parentNode.nextSibling)}
function addVideo(width,height,source,parentNode){var video=document.createElement('video');video.style.cssText='width:100vw;';video.controls=!0;video.autoplay=!0;video.id=parentNode.id+'big';var src=document.createElement('source');src.src=source;src.type='video/mp4';video.appendChild(src);parentNode.parentNode.insertBefore(video,parentNode.nextSibling)}
function logger(textContent){if(LOGGER===!0){console.log(textContent)}}
function unescapeHtml(unsafe){return unsafe.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,"\"").replace(/&#039;/g,"'")}
</script>
</html>
